{
    "class": "CommandLineTool",
    "name": "diffdock",
    "description": "Docking of small molecules to a protein",
    "baseCommand": ["/bin/bash", "-c"],
    "arguments": [
        "python datasets/esm_embedding_preparation.py --protein_path $(inputs.protein.filepath) --out_file ../outputs/prepared_for_esm.fasta;",
        "HOME=esm/model_weights python esm/scripts/extract.py esm2_t33_650M_UR50D ../outputs/prepared_for_esm.fasta ../outputs/esm2_output --repr_layers $(inputs.repr_layers.default) --include per_tok && cp -r ../outputs/esm2_output data/esm2_output;",
        "python -m inference --protein_path $(inputs.protein.filepath) --ligand $(inputs.small_molecule.filepath) --out_dir /outputs --inference_steps $(inputs.inference_steps.default) --samples_per_complex $(inputs.samples_per_complex.default) --batch_size $(inputs.batch_size.default) --actual_steps $(inputs.actual_steps.default) --no_final_step_noise;",
        "cp $(inputs.protein.filepath) /outputs"
      ],
    "dockerPull": "ghcr.io/labdao/equibind@sha256:ae2cec63b3924774727ed1c6c8af95cf4aaea2d3f0c5acbec56478505ccb2b07",
    "gpuBool": true,
    "networkBool": true,
    "inputs": {
      "protein": {
        "type": "File",
        "glob": ["*.pdb"]
      },
      "small_molecule": {
        "type": "File",
        "glob": ["*.sdf", "*.mol2"]
      },
      "repr_layers": {
        "type": "int",
        "default": "33"
      },
      "inference_steps": {
        "type": "int",
        "default": "20"
      },
      "samples_per_complex": {
        "type": "int",
        "default": "40"
      },
      "batch_size": {
        "type": "int",
        "default": "10"
      },
      "actual_steps": {
        "type": "int",
        "default": "18"
      }
    },
    "outputs": {
      "best_docked_small_molecule": {
        "type": "File",
        "glob": ["index*/rank1_confidence-*.sdf"]
      },
      "all_docked_small_molecules": {
        "type": "File",
        "glob": ["index*/rank*_confidence-*.sdf"]
      },
      "protein": {
        "type": "File",
        "glob": ["*.pdb"]
      }
    }
}
